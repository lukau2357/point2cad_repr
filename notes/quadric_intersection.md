# Quadric Surface Intersection

---

## Homogeneous coordinates and projective space

Working in ordinary Euclidean space $\mathbb{R}^3$ causes awkward
special cases: parallel lines never meet, a plane is a degenerate quadric,
and polynomials may have fewer roots than their degree predicts.
**Projective space** $\mathbb{P}^3$ resolves all of these uniformly.

### Construction

A point in $\mathbb{P}^3$ is an **equivalence class** of non-zero vectors in
$\mathbb{R}^4$:

$$[X : Y : Z : W] \;=\; \{\,\lambda(X,Y,Z,W) : \lambda \in \mathbb{R}\setminus\{0\}\,\}.$$

Two vectors represent the same projective point if and only if they are
proportional.  The four coordinates $(X,Y,Z,W)$ are called **homogeneous
coordinates** — they are only defined up to a common non-zero scalar.

### Embedding affine space

The affine space $\mathbb{R}^3$ embeds into $\mathbb{P}^3$ by

$$\mathbb{R}^3 \hookrightarrow \mathbb{P}^3, \qquad (x,y,z) \mapsto [x : y : z : 1].$$

The inverse map $[X:Y:Z:W] \mapsto (X/W,\, Y/W,\, Z/W)$ is defined whenever
$W \neq 0$.  Points with $W = 0$ are **points at infinity** (or ideal
points): they correspond to directions in $\mathbb{R}^3$ and have no affine
representative.  For example, $[1:0:0:0]$ is the point at infinity in the
$x$-direction — the "meeting point" of all lines parallel to the $x$-axis.

### Why homogeneous coordinates

1. **Bézout's theorem holds without exceptions.** Two degree-$d_1$ and
   degree-$d_2$ hypersurfaces in $\mathbb{P}^n$ intersect in exactly
   $d_1 d_2$ points (counted with multiplicity and over $\mathbb{C}$).
   In $\mathbb{R}^3$ this would fail: two parallel planes share no point.
   In $\mathbb{P}^3$ they share exactly one point at infinity — their
   common direction.

2. **All quadrics are unified.** A plane ($A = 0$ in affine form) becomes
   a rank-1 or rank-2 quadric in homogeneous form.  Cylinders (apex at
   infinity) and cones (finite apex) are both rank-3 quadrics differing
   only in whether the null vector has $W = 0$.

3. **Linear algebra governs geometry.** A projective transformation is
   simply a $4 \times 4$ invertible matrix acting on homogeneous
   coordinates.  Intersection, tangency, and duality all reduce to linear
   algebra on the coefficient matrices.

---

## The implicit quadric form

A **quadric** $Q \subset \mathbb{P}^3$ is the zero set of a degree-2
homogeneous polynomial:

$$Q = \{\,\tilde{\mathbf{x}} \in \mathbb{P}^3 : \tilde{\mathbf{x}}^\top \mathcal{Q}\,\tilde{\mathbf{x}} = 0\,\}, \qquad
\mathcal{Q} \in \mathbb{R}^{4\times 4} \text{ symmetric.}$$

Here $\tilde{\mathbf{x}} = (X,Y,Z,W)^\top$.  Because the coordinates are
homogeneous, scaling $\tilde{\mathbf{x}}$ by $\lambda$ scales the polynomial
by $\lambda^2$, so the zero set is well-defined on $\mathbb{P}^3$.

Setting $W = 1$ recovers the affine form

$$\mathcal{Q} = \begin{pmatrix} A & \tfrac{1}{2}\mathbf{b} \\ \tfrac{1}{2}\mathbf{b}^\top & c \end{pmatrix},
\qquad Q(\mathbf{x}) = \mathbf{x}^\top A\mathbf{x} + \mathbf{b}^\top\mathbf{x} + c = 0.$$

### Classification by $\operatorname{rank}(\mathcal{Q})$

The rank and inertia index (number of positive eigenvalues $p$, negative $q$)
fully classify the projective type:

| $\operatorname{rank}(\mathcal{Q})$ | $(p,q)$ | Projective type |
|---|---|---|
| 1 | $(1,0)$ | double plane |
| 2 | $(2,0)$ | imaginary pair of planes (no real points) |
| 2 | $(1,1)$ | real pair of planes |
| 3 | $(3,0)$ or $(2,1)$ | imaginary / real cone |
| 4 | $(4,0)$ | imaginary quadric (no real points) |
| 4 | $(3,1)$ | ellipsoid (or sphere) |
| 4 | $(2,2)$ | hyperboloid (one or two sheets, depending on affine form) |

The cylinder and paraboloid are affine specialisations of rank-4 quadrics:
a cylinder is an ellipsoid/hyperboloid whose apex is at infinity ($W = 0$),
giving one zero eigenvalue of the upper-left $3\times 3$ block $A$.

---

## Intersection of two quadrics: the pencil

By **Bézout's theorem**, the intersection $C = Q_1 \cap Q_2$ of two quadrics
in $\mathbb{P}^3$ is a degree-$4$ algebraic curve (counted with multiplicity
over $\mathbb{C}$).  In special cases (common component, tangency) the
degree drops, but generically the intersection is a quartic space curve.

### Definition of a pencil

The **pencil** generated by $Q_1$ and $Q_2$ is the one-parameter family

$$\mathcal{Q}_\lambda = \mathcal{Q}_1 + \lambda\,\mathcal{Q}_2, \qquad \lambda \in \mathbb{P}^1.$$

Geometrically, the space of all $4\times 4$ symmetric matrices is a
10-dimensional vector space.  The pencil is the projective **line** in this
space passing through $\mathcal{Q}_1$ and $\mathcal{Q}_2$.  Every member
$Q_\lambda$ is a quadric surface.

**Key property:** if $\tilde{\mathbf{p}} \in Q_1 \cap Q_2$, then
$\tilde{\mathbf{p}}^\top \mathcal{Q}_1 \tilde{\mathbf{p}} = 0$ and
$\tilde{\mathbf{p}}^\top \mathcal{Q}_2 \tilde{\mathbf{p}} = 0$, so
$\tilde{\mathbf{p}}^\top \mathcal{Q}_\lambda \tilde{\mathbf{p}} = 0$ for
**all** $\lambda$.  Every member of the pencil contains the entire
intersection curve $C$.  The pencil is the set of all quadrics through $C$
that happen to be linear combinations of $Q_1$ and $Q_2$.

---

## Reducing to polynomial roots: the characteristic polynomial

A pencil member $Q_\lambda$ is **degenerate** (rank-deficient) when

$$p(\lambda) = \det(\mathcal{Q}_1 + \lambda\,\mathcal{Q}_2) = 0.$$

Expanding this $4\times 4$ determinant yields a polynomial of degree
$\leq 4$ in $\lambda$.  This is the **characteristic polynomial** of the
pencil.

### What its roots mean geometrically

Each real root $\lambda^*$ gives a degenerate quadric $Q_{\lambda^*}$:

- **$\operatorname{rank} = 2$ (pair of real planes $\pi_1 \cup \pi_2$):**
  $Q_{\lambda^*} = \pi_1 \cup \pi_2$.  Since $C \subset Q_{\lambda^*}$, the
  quartic intersection splits:
  $$C = Q_1 \cap (\pi_1 \cup \pi_2) = \underbrace{(Q_1 \cap \pi_1)}_{\text{conic}} \cup \underbrace{(Q_1 \cap \pi_2)}_{\text{conic}}.$$
  The degree-4 curve decomposes into **two conics** — each is a degree-2
  curve lying in a known plane and on a known quadric, both of which are
  trivial to parametrise (see below).

- **$\operatorname{rank} = 3$ (cone):** $Q_{\lambda^*}$ is a cone with
  vertex $\mathbf{v}$ (the null vector).  The intersection $Q_1 \cap Q_{\lambda^*}$
  still decomposes (less cleanly) into curves on each ruling of the cone;
  this case is used when no rank-2 root exists.

- **$\operatorname{rank} = 2$ but imaginary planes:** the root is real but
  the plane pair is complex-conjugate.  The intersection $C$ has no real
  components along these planes; one must look for another root or use
  numerical methods.

So **surface intersection reduces to polynomial root-finding**: solve
$p(\lambda) = 0$ (a degree-$\leq 4$ polynomial, analytically solvable by
radicals), then factor the resulting degenerate matrix into planes, then
intersect each plane with one of the original quadrics to get conics.

### Recovering the plane pair from a rank-2 matrix

Given $\mathcal{Q}^* = \mathcal{Q}_1 + \lambda^*\mathcal{Q}_2$ of rank 2,
write $\mathcal{Q}^* = \mathbf{u}\mathbf{v}^\top + \mathbf{v}\mathbf{u}^\top$
for vectors $\mathbf{u}, \mathbf{v} \in \mathbb{R}^4$.  The two planes are

$$\pi_1 : (\mathbf{u} + \mathbf{v})^\top \tilde{\mathbf{x}} = 0, \qquad
\pi_2 : (\mathbf{u} - \mathbf{v})^\top \tilde{\mathbf{x}} = 0.$$

The vectors $\mathbf{u}, \mathbf{v}$ are found from the null space and
cofactor matrix of $\mathcal{Q}^*$; Dupont et al. (2006) give a numerically
stable algorithm for this step.

---

## Plane ∩ quadric: parametrising a conic

Once we have a plane $\pi$ and a quadric $Q_1$, their intersection is a
**conic section** — a degree-2 curve in $\pi \cong \mathbb{P}^2$.

Choose an orthonormal basis $\{\mathbf{e}_1, \mathbf{e}_2\}$ for $\pi$
(with origin $\mathbf{p}_0$ on $\pi$) and write $\mathbf{x} = \mathbf{p}_0 + s\mathbf{e}_1 + t\mathbf{e}_2$.
Substituting into the affine quadric:

$$\begin{pmatrix}s \\ t\end{pmatrix}^\top M_2 \begin{pmatrix}s \\ t\end{pmatrix} + \mathbf{m}_1^\top\begin{pmatrix}s\\ t\end{pmatrix} + m_0 = 0,
\qquad M_2 = \begin{pmatrix}\mathbf{e}_1^\top A \mathbf{e}_1 & \mathbf{e}_1^\top A \mathbf{e}_2 \\ \mathbf{e}_2^\top A \mathbf{e}_1 & \mathbf{e}_2^\top A \mathbf{e}_2\end{pmatrix}.$$

The $2\times 2$ matrix $M_2$ determines the conic type:
$\det(M_2) > 0$ → ellipse (or circle if $M_2 = \alpha I$),
$\det(M_2) = 0$ → parabola, $\det(M_2) < 0$ → hyperbola.

### Rational parametrisation of the conic

A non-degenerate real conic always admits a **rational parametrisation**:
pick any one point $\mathbf{p}^*$ on the conic (found e.g. by fixing $s$ and
solving the resulting quadratic in $t$).  Then project through $\mathbf{p}^*$
onto a line:

$$\mathbf{c}(t) = \mathbf{p}^* + t\,\mathbf{d}, \qquad t \in \mathbb{R},$$

and substitute into the conic equation.  One root is always $t = 0$
(corresponding to $\mathbf{p}^*$); the other root

$$t^*(s) = -\frac{\text{linear terms}(s)}{\text{quadratic coefficient}}$$

is rational in the line-direction parameter $s$.  This gives every point on
the conic as a rational function of one parameter — exactly the form needed
for a `Geom_BSplineCurve` or analytical `Geom_Circle`/`Geom_Ellipse`.

---

## The full reduction pipeline

```
Q1 ∩ Q2  (degree-4 curve)
    │
    │  solve det(Q1 + λQ2) = 0  [degree ≤ 4 polynomial in λ]
    ↓
degenerate pencil member Q* of rank 2
    │
    │  factor Q* = π1 · π2  [linear algebra on rank-2 matrix]
    ↓
two planes π1, π2
    │
    │  for each πi: substitute into Q1
    ↓
two conics  C1 = Q1∩π1,  C2 = Q1∩π2  (degree-2 curves in known planes)
    │
    │  rational parametrisation from one known point on each conic
    ↓
parametric curves  (circle, ellipse, hyperbola, or parabola)
```

Every arrow in this pipeline reduces to polynomial root-finding or linear
algebra — no numerical surface solver is needed.

---

## When the reduction fails over $\mathbb{R}$

The characteristic polynomial $p(\lambda) = 0$ always has 4 roots over
$\mathbb{C}$, but may have no real rank-2 root.  This happens e.g. for two
circular cylinders with orthogonal axes of equal radius: their intersection
is a degree-4 Viviani-type curve with no real conic decomposition.

In this case:
1. Look for a real rank-3 root (cone): the intersection still decomposes,
   but into higher-degree pieces that require one more step.
2. Fall back to numerical marching / subdivision (what `GeomAPI_IntSS` does).

---

## Extension to B-splines and NURBS

B-spline surfaces are **not** algebraic in general (they are piecewise
polynomial but not a single polynomial over their full domain).  Two
strategies exist for applying algebraic methods:

### Degree-2 rational NURBS (exact quadrics)

Circles, cylinders, cones, and spheres can be represented *exactly* as
rational quadratic NURBS (weights adjusted to produce a weight-2 rational
parametrisation).  Their implicit form is a degree-2 polynomial, so the
pencil method applies directly after converting to the $\mathcal{Q}$ matrix.

### Implicitisation via moving planes (higher degree)

A rational parametric patch $\mathbf{F}(s,t)$ of bi-degree $(d_1, d_2)$
satisfies **moving plane** equations (syzygies)
$\mathbf{a}(s,t) \cdot \tilde{\mathbf{x}} = 0$ where $\mathbf{a}$ is
polynomial in $(s,t)$.  Eliminating $(s,t)$ via the **Dixon resultant**
yields the implicit equation as a matrix determinant.  The implicit degree
is generically $d_1 d_2$: degree 4 for bi-cubic patches, degree 9 for
bi-quartic, etc.  Intersecting two such implicits gives a curve of degree
$(d_1 d_2)^2$, which is tractable symbolically for low degrees but quickly
becomes expensive.

For INR-derived B-spline patches (bi-cubic or higher), this route is
available in principle but `GeomAPI_IntSS` is faster in practice.

---

## Practical status for this pipeline

| Pair | Current handling | Could be analytical? |
|---|---|---|
| plane ∩ plane | analytical (line) | — already done |
| plane ∩ sphere | analytical (circle) | — already done |
| sphere ∩ sphere | analytical (radical plane → circle) | — already done |
| plane ∩ cylinder/cone | OCC fallback | yes — plane ∩ quadric = conic |
| sphere ∩ cylinder/cone | OCC fallback | yes — pencil gives two conics |
| cylinder ∩ cylinder | OCC fallback | sometimes (pencil, if real rank-2 root exists) |
| cylinder/cone ∩ B-spline | OCC fallback | no — numerical only |
| B-spline ∩ B-spline | OCC fallback | no — numerical only |

---

## References

**Quadric intersection — algebraic and geometric:**

- Dupont, L., Lazard, D., Lazard, S., & Petitjean, S. (2006).
  *Near-optimal parameterization of the intersection of quadrics: I, II, III.*
  Journal of Symbolic Computation 43(3):168–210.
  *(Definitive treatment; certified numerical pencil algorithm.)*

- Levin, J. Z. (1976).
  *A parametric algorithm for drawing pictures of solid objects composed of quadric surfaces.*
  Communications of the ACM 19(10):555–563.
  *(Introduces the pencil/degenerate-member decomposition in a practical context.)*

- Lazard, S., Peñaranda, L., & Petitjean, S. (2006).
  *Intersecting quadrics: An efficient and exact implementation.*
  Computational Geometry 35(1):74–99.

- Miller, J. R., & Goldman, R. N. (1992).
  *Geometric algorithms for detecting and calculating all conic sections in the intersection of any two NURBS surfaces.*
  CVS Technical Report.

**Implicitisation and resultants:**

- Cox, D., Little, J., & O'Shea, D. (2005).
  *Using Algebraic Geometry* (2nd ed.). Springer.
  *(Chapters 3–4: resultants, Dixon resultant, moving planes.)*

- Sederberg, T. W., & Chen, F. (1995).
  *Implicitization using moving lines.*
  SIGGRAPH Computer Graphics 29:301–308.

- Chionh, E. W., Goldman, R. N., & Miller, J. R. (1991).
  *Using multivariate resultants to find the implicit equation of a parametric curve.*
  The Visual Computer 8(3):171–180.

**Numerical surface–surface intersection:**

- Barnhill, R. E., Farin, G., Jordan, M., & Piper, B. R. (1987).
  *Surface/surface intersection.*
  Computer Aided Geometric Design 4(1):3–16.

- Patrikalakis, N. M., & Maekawa, T. (2002).
  *Shape Interrogation for Computer Aided Design and Manufacturing.*
  Springer. Chapters 7–9.  *(Freely available online.)*

- Sederberg, T. W., & Nishita, T. (1990).
  *Curve intersection using Bézier clipping.*
  Computer-Aided Design 22(9):538–549.

**Projective geometry and algebraic geometry background:**

- Semple, J. G., & Kneebone, G. T. (1952).
  *Algebraic Projective Geometry.* Oxford University Press.
  *(Classical pencils of quadrics, rational parametrisation of conics.)*

- Griffiths, P., & Harris, J. (1978).
  *Principles of Algebraic Geometry.* Wiley.
  *(Bézout's theorem, linear systems, intersection theory.)*
